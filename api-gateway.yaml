spring:
  cloud:
    gateway:
      server:
        webflux:
          discovery:
            locator:
              enabled: true
              lower-case-service-id: true
          routes:
            - id: movie-catalog-service
              uri: lb://movie-catalog-service
              predicates:
                - Path=/catalog/**
              filters:
                - StripPrefix=1
                - AddRequestHeader=X-Internal-Call, true
            - id: movie-rating-data-service
              uri: lb://movie-rating-data-service
              predicates:
                - Path=/ratingsdata/**
              filters:
                - StripPrefix=1
                - AddRequestHeader=X-Internal-Call, true
            - id: movie-info-service
              uri: lb://movie-info-service
              predicates:
                - Path=/movies/**
              filters:
                - StripPrefix=1
                - AddRequestHeader=X-Internal-Call, true

filters:
  - name: CircuitBreaker
    args:
      name: catalogCB
      fallbackUri: forward:/fallback/catalog
  - name: RequestRateLimiter
    args:
      redis-rate-limiter.replenishRate: 10
      redis-rate-limiter.burstCapacity: 20

management:
  endpoints:
    web:
      exposure:
        include: "health,info,gateway"

